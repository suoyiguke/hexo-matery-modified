---
title: 能用实体类就不要图方便用HashMap.md
top: false
cover: false
toc: true
mathjax: true
date: 2022-03-20 18:16:49
password:
summary:
tags: java基础
categories: java基础
---

1、HashMap比起简单的实体类占用空间非常大

场景：100W行的大数据量查询，使用List<HashMap> 结构导致OOM

但这种方式只能解决燃眉之急，归根结底还是要看看到底是什么数据一次性占了 1.6 个 G！
仔细一看，List 里面装的都是 Map，每个 Map 表示数据库中的一行数据，总共 100 万行 15 列。
这，这不对吧，这些数据在数据库、Excel 文件里才不到 100 MB，咋变成 Map 直接膨胀了十几倍？
于是，我试着输出了一下 List<Map> 对象的大小，发现 105 行 * 10 列就占用了 155.9 KB！100万行的话真就 1.6 个 G 了！

那一刻，我突然想起了被八股文支配的恐惧，Java 的 HashMap 占用空间的确是很大的！每个 HashMap 对象包含 12 字节的 Java 对象头、4 个引用字段、3 个 int 型字段、1 个 float 字段，这些加起来是 44 字节。因为 JVM 要求对象内存大小必须是 8 字节的倍数，所以还要再补上 4 个字节，最终一个空的 HashMap 就占用了 48 字节。用它来存数据，可比其他格式的文件要大多了！

不过吃一堑长一智，下次再遇到类似问题（希望不会有下次），我应该就能很快解决啦。实践 + 翻车，印象真的太深刻了！所以建议大家在背八股文的同时，还是多多写代码做实验哦~

至于这个问题怎么解决。。那就别用 HashMap 呗！用 List + 下标来表示一行数据应该是可行的。当然，大家有更好的方案欢迎讨论~ 

>使用 List<List> 代替List<Map>

2、视图层使用HashMap当参数接收可读性维护性也不好。方法栈占用空间也特别大。mybatis中请使用resultType、resultMap接收

3、数据库查询参数也不要用HashMap
